<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"shakudada.xyz","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"79C1GXGOC6","apiKey":"225fa4bf2bc37c3e46a671682674fe37","indexName":"my-hexo-blog","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="dinosaur">
<meta property="og:url" content="https://shakudada.xyz/page/15/index.html">
<meta property="og:site_name" content="dinosaur">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="dinosaur">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://shakudada.xyz/page/15/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>dinosaur</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">dinosaur</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

      
    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shakudada.xyz/2021/09/26/redis-cluster/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dinosaur">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dinosaur">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/26/redis-cluster/" class="post-title-link" itemprop="url">redis cluster</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-26 20:46:24" itemprop="dateCreated datePublished" datetime="2021-09-26T20:46:24+08:00">2021-09-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 11:42:47" itemprop="dateModified" datetime="2023-10-25T11:42:47+08:00">2023-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>拉代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/redis/redis.git</span><br><span class="line">cd redis/</span><br><span class="line">## 带上调试信息</span><br><span class="line">make CFLAGS=&quot;-g -O0&quot; </span><br><span class="line">## 创建一个目录</span><br><span class="line">mkdir rediscluster </span><br><span class="line">mkdir 7000 7001 7002 7003 7004 7005</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>创建几个节点胡配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tree</span><br><span class="line">.</span><br><span class="line">├── 7000</span><br><span class="line">├── 7001</span><br><span class="line">├── 7002</span><br><span class="line">├── 7003</span><br><span class="line">├── 7004</span><br><span class="line">└── 7005</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后像这样启动6个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src/redis-server rediscluster/7001/redis.conf</span><br></pre></td></tr></table></figure>


<p>主动下线是一个命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLUSTER FAILOVER</span><br></pre></td></tr></table></figure>


<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/topics/cluster-tutorial">https://redis.io/topics/cluster-tutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/cluster-failover">https://redis.io/commands/cluster-failover</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shakudada.xyz/2021/09/25/redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dinosaur">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dinosaur">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/25/redis/" class="post-title-link" itemprop="url">redis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-25 23:34:07" itemprop="dateCreated datePublished" datetime="2021-09-25T23:34:07+08:00">2021-09-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 11:42:47" itemprop="dateModified" datetime="2023-10-25T11:42:47+08:00">2023-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>1 类型<br>string<br>list<br>set<br>zset<br>hash</p>
<p>2 对应的命令</p>
<p>set 命令   edis&#x2F;src&#x2F;t_string.c<br>string 的过期不是实时的</p>
<p>list   lpush lpop   &#x2F; 有ziplist 和双向链表组成</p>
<p>hash 有两个hashtable  ， 一个是内容一个谁拿来扩容</p>
<p>set  谁由intset 和 hashtable组成</p>
<p>zset  ziplist+ skiplist   </p>
<p>3 aof&#x2F;rdb   </p>
<p>aof 谁append only file  都是可读的文本 rdb谁整个盘快照</p>
<p>4 redis 淘汰</p>
<pre><code>noeviction:如果缓存数据超过了maxmemory限定值，并且客户端正在执行的命令(大部分的写入指令，但DEL和几个指令例外)会导致内存分配，则向客户端返回错误响应
allkeys-lru: 对所有的键都采取LRU淘汰
volatile-lru: 仅对设置了过期时间的键采取LRU淘汰
allkeys-random: 随机回收所有的键
volatile-random: 随机回收设置过期时间的键
volatile-ttl: 仅淘汰设置了过期时间的键---淘汰生存时间TTL(Time To Live)更小的键
</code></pre>
<h2 id="5-HA"><a href="#5-HA" class="headerlink" title="5 HA"></a>5 HA</h2><p>Redis Cluster master-replica model</p>
<p>In order to remain available when a subset of master nodes are failing or are not able to communicate with the majority of nodes, Redis Cluster uses a master-replica model where every hash slot has from 1 (the master itself) to N replicas (N-1 additional replica nodes).</p>
<p>In our example cluster with nodes A, B, C, if node B fails the cluster is not able to continue, since we no longer have a way to serve hash slots in the range 5501-11000.</p>
<p>However when the cluster is created (or at a later time) we add a replica node to every master, so that the final cluster is composed of A, B, C that are master nodes, and A1, B1, C1 that are replica nodes. This way, the system is able to continue if node B fails.</p>
<p>Node B1 replicates B, and B fails, the cluster will promote node B1 as the new master and will continue to operate correctly.</p>
<p>However, note that if nodes B and B1 fail at the same time, Redis Cluster is not able to continue to operate.</p>
<h3 id="failover-错误转移"><a href="#failover-错误转移" class="headerlink" title="failover 错误转移"></a>failover 错误转移</h3><p>当master 失去连接后，slave会向master 发起一个paxos 选票</p>
<h2 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h2><p>分片会路由到不同胡slot，运算方式要crc16（key）% 16384</p>
<p>每个分片会有特定slot</p>
<h3 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h3><p>不是强一致性，</p>
<p>Redis Cluster is not able to guarantee strong consistency. In practical terms this means that under certain conditions it is possible that Redis Cluster will lose writes that were acknowledged by the system to the client.</p>
<p>The first reason why Redis Cluster can lose writes is because it uses asynchronous replication. This means that during writes the following happens:</p>
<pre><code>Your client writes to the master B.
The master B replies OK to your client.
The master B propagates the write to its replicas B1, B2 and B3.
</code></pre>
<p>因为是异步的</p>
<h2 id="缓存穿透-雪崩"><a href="#缓存穿透-雪崩" class="headerlink" title="缓存穿透  雪崩"></a>缓存穿透  雪崩</h2><p>穿透是指通过redis<br>雪崩就是指同时失效</p>
<h2 id="限流"><a href="#限流" class="headerlink" title="限流"></a>限流</h2><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000040570911">https://segmentfault.com/a/1190000040570911</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shakudada.xyz/2021/08/09/redis-%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dinosaur">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dinosaur">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/09/redis-%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/" class="post-title-link" itemprop="url">redis 主从切换和高可用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-09 11:04:54" itemprop="dateCreated datePublished" datetime="2021-08-09T11:04:54+08:00">2021-08-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 11:42:47" itemprop="dateModified" datetime="2023-10-25T11:42:47+08:00">2023-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>相关阅读</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/aquester/p/10229415.html#:~:text=Redis%20%20%E9%9B%86%E7%BE%A4%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2%E9%87%87%E5%8F%96%E9%80%89%E4%B8%BE%E6%9C%BA%E5%88%B6%EF%BC%8C%E8%A6%81%E6%B1%82%E5%B0%91%E6%95%B0%E6%9C%8D%E4%BB%8E%E5%A4%9A%E6%95%B0%EF%BC%8C%E8%80%8C%E5%8F%82%E4%B8%8E%E9%80%89%E4%B8%BE%E7%9A%84%E5%8F%AA%E8%83%BD%E4%B8%BAmaster%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AA%E6%9C%89%E5%A4%9A%E6%95%B0master%E5%AD%98%E6%B4%BB%E5%8A%A8%E6%97%B6%E6%89%8D%E8%83%BD%E8%BF%9B%E8%A1%8C%EF%BC%8C%E9%80%89%E4%B8%BE%E7%94%B1slave%E5%8F%91%E8%B5%B7%E3%80%82%20Redis%20%E7%94%A8%E4%BA%86%E5%92%8CRaft%E7%AE%97%E6%B3%95term%EF%BC%88%E4%BB%BB%E6%9C%9F%EF%BC%89%E7%B1%BB%E4%BC%BC%E7%9A%84%E7%9A%84%E6%A6%82%E5%BF%B5%EF%BC%8C%E5%9C%A8,Redis%20%E4%B8%AD%E5%8F%AB%E4%BD%9Cepoch%EF%BC%88%E7%BA%AA%E5%85%83%EF%BC%89%EF%BC%8C%20epoch%20%E6%98%AF%E4%B8%80%E4%B8%AA%E6%97%A0%E7%AC%A6%E5%8F%B7%E7%9A%8464%E6%95%B4%E6%95%B0%EF%BC%8C%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%20epoch%E4%BB%8E0%E5%BC%80%E5%A7%8B%E3%80%82">https://www.cnblogs.com/aquester/p/10229415.html#:~:text=Redis%20%20%E9%9B%86%E7%BE%A4%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2%E9%87%87%E5%8F%96%E9%80%89%E4%B8%BE%E6%9C%BA%E5%88%B6%EF%BC%8C%E8%A6%81%E6%B1%82%E5%B0%91%E6%95%B0%E6%9C%8D%E4%BB%8E%E5%A4%9A%E6%95%B0%EF%BC%8C%E8%80%8C%E5%8F%82%E4%B8%8E%E9%80%89%E4%B8%BE%E7%9A%84%E5%8F%AA%E8%83%BD%E4%B8%BAmaster%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AA%E6%9C%89%E5%A4%9A%E6%95%B0master%E5%AD%98%E6%B4%BB%E5%8A%A8%E6%97%B6%E6%89%8D%E8%83%BD%E8%BF%9B%E8%A1%8C%EF%BC%8C%E9%80%89%E4%B8%BE%E7%94%B1slave%E5%8F%91%E8%B5%B7%E3%80%82%20Redis%20%E7%94%A8%E4%BA%86%E5%92%8CRaft%E7%AE%97%E6%B3%95term%EF%BC%88%E4%BB%BB%E6%9C%9F%EF%BC%89%E7%B1%BB%E4%BC%BC%E7%9A%84%E7%9A%84%E6%A6%82%E5%BF%B5%EF%BC%8C%E5%9C%A8,Redis%20%E4%B8%AD%E5%8F%AB%E4%BD%9Cepoch%EF%BC%88%E7%BA%AA%E5%85%83%EF%BC%89%EF%BC%8C%20epoch%20%E6%98%AF%E4%B8%80%E4%B8%AA%E6%97%A0%E7%AC%A6%E5%8F%B7%E7%9A%8464%E6%95%B4%E6%95%B0%EF%BC%8C%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%20epoch%E4%BB%8E0%E5%BC%80%E5%A7%8B%E3%80%82</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shakudada.xyz/2021/07/29/mysql-5-7-in-%E7%9A%84%E4%BC%98%E5%8C%96%E5%BC%95%E8%B5%B7%E7%9A%84bug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dinosaur">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dinosaur">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/29/mysql-5-7-in-%E7%9A%84%E4%BC%98%E5%8C%96%E5%BC%95%E8%B5%B7%E7%9A%84bug/" class="post-title-link" itemprop="url">mysql 5.7 in 的优化引起的bug</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-29 13:42:46" itemprop="dateCreated datePublished" datetime="2021-07-29T13:42:46+08:00">2021-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 11:42:47" itemprop="dateModified" datetime="2023-10-25T11:42:47+08:00">2023-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h4><p>有个1700w的表需要初始化 , 然后我们需要分批取id范围是[1 , 1000) , [1000 , 2000)的值 </p>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>很简单的sql  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update  test set    a.value=1 where id in ( 1 , 2 , 7 , 9.... 1000);</span><br><span class="line">update  test set    a.value=1 where id in ( 1001 , 1002 , 1005 , ... 2000);</span><br></pre></td></tr></table></figure>
<p>这里的id大概有100个左右 ,id是单调递增,基本连续</p>
<p>测试环境很正常,非常快 , 通过这个sql , 我们可以一秒update 1w以上的行</p>
<p>但是生产环境这个update特别特别慢,update 1000 行 大概需要 <code>50s</code>以上</p>
<h4 id="排查"><a href="#排查" class="headerlink" title="排查"></a>排查</h4><ul>
<li>定位<br>经过很多尝试,<br>定位到是update这个sql特别慢,而且是但是测试环境非常快,生产环境非常慢</li>
</ul>
<p>尝试explain</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain </span><br><span class="line">update  test as a set    a.value=1 where id in ( 1 , 2 , 7 , 9....);</span><br></pre></td></tr></table></figure>
<p>生产环境下是这样:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using where; Using temporary</span><br></pre></td></tr></table></figure>
<p>但是测试环境是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using where</span><br></pre></td></tr></table></figure>
<p>开始搜索,找到了类似的原因:<br><a target="_blank" rel="noopener" href="https://bugs.mysql.com/bug.php?id=80424">https://bugs.mysql.com/bug.php?id=80424</a><br>对比了一下版本:<br>生产环境:<code>5.7.9-log</code><br>测试环境:<code>5.7.22-log</code></p>
<p>确定binlog的记录形式:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@binlog_row_image</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FULL</span><br></pre></td></tr></table></figure>

<p>这个bug被5.7.15以上修复,所以测试环境没有问题,生产环境有问题</p>
<h4 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h4><p>因为生产版本的mysql几乎没有升级的可能,这个批量的刷数据如果10条&#x2F;s估计要刷一个星期,所以我们尝试了很多写法避免这个优化,最后使用了这个写法避免 生产版本的mysql的bug<br>不使用in 而是使用join 防止这个优化器的<code>bug</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DESC</span><br><span class="line">UPDATE `test` a JOIN (</span><br><span class="line">SELECT id FROM test t   WHERE  `id` IN (516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,533,532)</span><br><span class="line">) t ON a.id = t.id</span><br><span class="line">SET a.isvisible = -1;</span><br></pre></td></tr></table></figure>

<p>优化后不用temp了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;id&quot;	&quot;select_type&quot;	&quot;table&quot;	&quot;partitions&quot;	&quot;type&quot;	   &quot;possible_keys&quot;	&quot;key&quot;	&quot;key_len&quot;	&quot;ref&quot;	&quot;rows&quot;	&quot;filtered&quot;	&quot;Extra&quot;</span><br><span class="line">&quot;1&quot;	    &quot;UPDATE&quot;	     &quot;a&quot;	\N	            &quot;range&quot;	    &quot;PRIMARY&quot;	    &quot;PRIMARY&quot;	&quot;4&quot;	     \N	    &quot;104&quot;	&quot;100.00&quot;	&quot;Using where&quot;</span><br><span class="line">&quot;1&quot;	    &quot;SIMPLE&quot;	     &quot;b&quot;	\N	            &quot;eq_ref&quot;	&quot;PRIMARY&quot;	   &quot;PRIMARY&quot;	&quot;4&quot;	   &quot;a.id&quot;	&quot;1&quot;	    &quot;100.00&quot;	&quot;Using index&quot;</span><br></pre></td></tr></table></figure>
<h4 id="事后扒代码"><a href="#事后扒代码" class="headerlink" title="事后扒代码"></a>事后扒代码</h4><p>通过<a target="_blank" rel="noopener" href="https://bugs.mysql.com/bug.php?id=80424">https://bugs.mysql.com/bug.php?id=80424</a> 提供的patch大概定位到原因</p>
<p>为什么会使用temp表?</p>
<p>第六个参数是判断是否需要使用temp的 ,也就是 <code>!using_filesort &amp;&amp; (used_key_is_modified || order)</code> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Modification_plan plan(thd, MT_UPDATE, &amp;qep_tab,</span><br><span class="line">                       used_index, limit,</span><br><span class="line">                       (!using_filesort &amp;&amp; (used_key_is_modified || order)),</span><br><span class="line">                       using_filesort, used_key_is_modified, rows);</span><br></pre></td></tr></table></figure>
<p>查看<code>Modification_plan</code>这个类的定义:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Modification_plan(THD *thd_arg,</span><br><span class="line">                  enum_mod_type mt, QEP_TAB *qep_tab,</span><br><span class="line">                  uint key_arg, ha_rows limit_arg, bool need_tmp_table_arg,</span><br><span class="line">                  bool need_sort_arg, bool used_key_is_modified_arg,</span><br><span class="line">                  ha_rows rows);</span><br></pre></td></tr></table></figure>

<p>在这个问题中是 <code>used_key_is_modified = true</code>, 所以会产生temp表</p>
<p>相关阅读:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/facebook/mysql-5.6/issues/163">https://github.com/facebook/mysql-5.6/issues/163</a></li>
<li><a target="_blank" rel="noopener" href="https://bugs.mysql.com/bug.php?id=80424">https://bugs.mysql.com/bug.php?id=80424</a></li>
<li><a target="_blank" rel="noopener" href="https://bugs.mysql.com/bug.php?id=79867">https://bugs.mysql.com/bug.php?id=79867</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shakudada.xyz/2021/07/15/tcp-nodelay/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dinosaur">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dinosaur">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/15/tcp-nodelay/" class="post-title-link" itemprop="url">tcp_nodelay</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-15 10:57:27" itemprop="dateCreated datePublished" datetime="2021-07-15T10:57:27+08:00">2021-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 11:42:47" itemprop="dateModified" datetime="2023-10-25T11:42:47+08:00">2023-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="tcp-nodealy"><a href="#tcp-nodealy" class="headerlink" title="tcp_nodealy"></a>tcp_nodealy</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"> The solution to the small-packet problem</span><br><span class="line"> 解决小包问题的方法</span><br><span class="line"></span><br><span class="line">Clearly an adaptive approach is desirable.  One  would  expect  a</span><br><span class="line">proposal  for  an  adaptive  inter-packet time limit based on the</span><br><span class="line">round-trip delay observed by TCP.  While such a  mechanism  could</span><br><span class="line">certainly  be  implemented,  it  is  unnecessary.   A  simple and</span><br><span class="line">elegant solution has been discovered.</span><br><span class="line"></span><br><span class="line">The solution is to inhibit the sending of new TCP  segments  when</span><br><span class="line">new  outgoing  data  arrives  from  the  user  if  any previously</span><br><span class="line">transmitted data on the connection remains unacknowledged.   This</span><br><span class="line">inhibition  is  to be unconditional; no timers, tests for size of</span><br><span class="line">data received, or other conditions are required.   Implementation</span><br><span class="line">typically requires one or two lines inside a TCP program.</span><br><span class="line">解决的方式是如果之前发送的数据没有被ack,阻止发送新的tcp段.这个抑制条件是不需要前置的条件的:不需要定时器,不需要探测包是否被接收,以及其他条件.实现上只需要添加一两行代码在tcp程序里面</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">At first glance, this solution seems to imply drastic changes  in</span><br><span class="line">the  behavior of TCP.  This is not so.  It all works out right in</span><br><span class="line">the end.  Let us see why this is so.</span><br><span class="line">乍看起来,这会很大地改变tcp的行为.但是实际上并不是这样,这从头到尾都没有太大变化.让我们看看为什么是这样.</span><br><span class="line"></span><br><span class="line">When a user process writes to a TCP connection, TCP receives some</span><br><span class="line">data.   It  may  hold  that data for future sending or may send a</span><br><span class="line">packet immediately.  If it refrains from  sending  now,  it  will</span><br><span class="line">typically send the data later when an incoming packet arrives and</span><br><span class="line">changes the state of the system.  The state changes in one of two</span><br><span class="line">ways;  the incoming packet acknowledges old data the distant host</span><br><span class="line">has received, or announces the availability of  buffer  space  in</span><br><span class="line">the  distant  host  for  new  data.  (This last is referred to as</span><br><span class="line">&quot;updating the window&quot;).    Each time data arrives  on  a  connec-</span><br><span class="line">tion,  TCP must reexamine its current state and perhaps send some</span><br><span class="line">packets out.  Thus, when we omit sending data on arrival from the</span><br><span class="line">user,  we  are  simply  deferring its transmission until the next</span><br><span class="line">message arrives from the distant host.   A  message  must  always</span><br><span class="line">arrive soon unless the connection was previously idle or communi-</span><br><span class="line">cations with the other end have been lost.  In  the  first  case,</span><br><span class="line">the  idle  connection,  our  scheme will result in a packet being</span><br><span class="line">sent whenever the user writes to the TCP connection.  Thus we  do</span><br><span class="line">not  deadlock  in  the idle condition.  In the second case, where</span><br><span class="line">当一个用户写消息到tcp连接,Tcp协议栈会受到这些信息.tcp协议栈会保持这些内容或者立马发送这些内容.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RFC 896    Congestion Control in IP/TCP Internetworks      1/6/84</span><br><span class="line"></span><br><span class="line">the distant host has failed, sending more data is futile  anyway.</span><br><span class="line">Note  that we have done nothing to inhibit normal TCP retransmis-</span><br><span class="line">sion logic, so lost messages are not a problem.</span><br><span class="line"></span><br><span class="line">Examination of the behavior of this scheme under  various  condi-</span><br><span class="line">tions  demonstrates  that the scheme does work in all cases.  The</span><br><span class="line">first case to examine is the one we wanted to solve, that of  the</span><br><span class="line">character-oriented  Telnet  connection.   Let us suppose that the</span><br><span class="line">user is sending TCP a new character every  200ms,  and  that  the</span><br><span class="line">connection  is  via  an Ethernet with a round-trip time including</span><br><span class="line">software processing of 50ms.  Without any  mechanism  to  prevent</span><br><span class="line">small-packet congestion, one packet will be sent for each charac-</span><br><span class="line">ter, and response will be optimal.  Overhead will be  4000%,  but</span><br><span class="line">this  is  acceptable  on  an Ethernet.  The classic timer scheme,</span><br><span class="line">with a limit of 2 packets per second, will  cause  two  or  three</span><br><span class="line">characters to be sent per packet.  Response will thus be degraded</span><br><span class="line">even though on a high-bandwidth  Ethernet  this  is  unnecessary.</span><br><span class="line">Overhead  will  drop  to  1500%, but on an Ethernet this is a bad</span><br><span class="line">tradeoff.  With our scheme, every character the user  types  will</span><br><span class="line">find  TCP with an idle connection, and the character will be sent</span><br><span class="line">at once, just as in the no-control case.  The user  will  see  no</span><br><span class="line">visible  delay.   Thus,  our  scheme  performs as well as the no-</span><br><span class="line">control scheme and provides better responsiveness than the  timer</span><br><span class="line">scheme.</span><br><span class="line"></span><br><span class="line">The second case to examine is the same Telnet  test  but  over  a</span><br><span class="line">long-haul  link  with  a  5-second  round trip time.  Without any</span><br><span class="line">mechanism to prevent  small-packet  congestion,  25  new  packets</span><br><span class="line">would be sent in 5 seconds.* Overhead here is  4000%.   With  the</span><br><span class="line">classic timer scheme, and the same limit of 2 packets per second,</span><br><span class="line">there would still be 10 packets outstanding and  contributing  to</span><br><span class="line">congestion.  Round-trip time will not be improved by sending many</span><br><span class="line">packets, of course; in general it will be worse since the packets</span><br><span class="line">will  contend  for line time.  Overhead now drops to 1500%.  With</span><br><span class="line">our scheme, however, the first character from the user would find</span><br><span class="line">an  idle  TCP connection and would be sent immediately.  The next</span><br><span class="line">24 characters, arriving from the user at 200ms  intervals,  would</span><br><span class="line">be  held  pending  a  message from the distant host.  When an ACK</span><br><span class="line">arrived for the first packet at the end of 5  seconds,  a  single</span><br><span class="line">packet  with  the 24 queued characters would be sent.  Our scheme</span><br><span class="line">thus results in an overhead reduction to 320% with no penalty  in</span><br><span class="line">response  time.   Response time will usually be improved with our</span><br><span class="line">scheme because packet overhead is reduced, here by  a  factor  of</span><br><span class="line">4.7 over the classic timer scheme.  Congestion will be reduced by</span><br><span class="line">this factor and round-trip delay will decrease sharply.  For this</span><br><span class="line">________</span><br><span class="line">  * This problem is not seen in the pure ARPANET case because the</span><br><span class="line">    IMPs will block the host when the count of packets</span><br><span class="line">    outstanding becomes excessive, but in the case where a pure</span><br><span class="line">    datagram local net (such as an Ethernet) or a pure datagram</span><br><span class="line">    gateway (such as an ARPANET / MILNET gateway) is involved, it</span><br><span class="line">    is possible to have large numbers of tiny packets</span><br><span class="line">    outstanding.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RFC 896    Congestion Control in IP/TCP Internetworks      1/6/84</span><br><span class="line"></span><br><span class="line">case, our scheme has a striking  advantage  over  either  of  the</span><br><span class="line">other approaches.</span><br><span class="line"></span><br><span class="line">We use our scheme for all TCP connections, not just  Telnet  con-</span><br><span class="line">nections.   Let us see what happens for a file transfer data con-</span><br><span class="line">nection using our technique. The two extreme cases will again  be</span><br><span class="line">considered.</span><br><span class="line"></span><br><span class="line">As before, we first consider the Ethernet case.  The user is  now</span><br><span class="line">writing data to TCP in 512 byte blocks as fast as TCP will accept</span><br><span class="line">them.  The user&#x27;s first write to TCP will start things going; our</span><br><span class="line">first  datagram  will  be  512+40  bytes  or 552 bytes long.  The</span><br><span class="line">user&#x27;s second write to TCP will not cause a send but  will  cause</span><br><span class="line">the  block  to  be buffered.  Assume that the user fills up TCP&#x27;s</span><br><span class="line">outgoing buffer area before the first ACK comes back.  Then  when</span><br><span class="line">the  ACK  comes in, all queued data up to the window size will be</span><br><span class="line">sent.  From then on, the window will be kept full,  as  each  ACK</span><br><span class="line">initiates  a  sending  cycle  and queued data is sent out.  Thus,</span><br><span class="line">after a one round-trip time initial period when only one block is</span><br><span class="line">sent,  our  scheme  settles down into a maximum-throughput condi-</span><br><span class="line">tion.  The delay in startup is only 50ms on the Ethernet, so  the</span><br><span class="line">startup  transient  is  insignificant.  All three schemes provide</span><br><span class="line">equivalent performance for this case.</span><br><span class="line"></span><br><span class="line">Finally, let us look at a file transfer over the  5-second  round</span><br><span class="line">trip  time connection.  Again, only one packet will be sent until</span><br><span class="line">the first ACK comes back; the window will then be filled and kept</span><br><span class="line">full.   Since the round-trip time is 5 seconds, only 512 bytes of</span><br><span class="line">data are transmitted in the first 5 seconds.  Assuming a 2K  win-</span><br><span class="line">dow,  once  the first ACK comes in, 2K of data will be sent and a</span><br><span class="line">steady rate of 2K per 5 seconds will  be  maintained  thereafter.</span><br><span class="line">Only  for  this  case is our scheme inferior to the timer scheme,</span><br><span class="line">and the difference is only in the startup transient; steady-state</span><br><span class="line">throughput  is  identical.  The naive scheme and the timer scheme</span><br><span class="line">would both take 250 seconds to transmit a 100K  byte  file  under</span><br><span class="line">the  above  conditions  and  our scheme would take 254 seconds, a</span><br><span class="line">difference of 1.6%.</span><br><span class="line"></span><br><span class="line">Thus, for all cases examined, our scheme provides at least 98% of</span><br><span class="line">the  performance  of  both other schemes, and provides a dramatic</span><br><span class="line">improvement in Telnet performance over paths with long round trip</span><br><span class="line">times.   We  use  our  scheme  in  the  Ford  Aerospace  Software</span><br><span class="line">Engineering Network, and are able to run screen editors over Eth-</span><br><span class="line">ernet and talk to distant TOPS-20 hosts with improved performance</span><br><span class="line">in both cases.</span><br></pre></td></tr></table></figure>


<h2 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h2><ul>
<li><a target="_blank" rel="noopener" href="https://dt-test.rjsparks.org/doc/rfc896/?include_text=1">https://dt-test.rjsparks.org/doc/rfc896/?include_text=1</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shakudada.xyz/2021/06/22/skiplist/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dinosaur">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dinosaur">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/22/skiplist/" class="post-title-link" itemprop="url">skiplist</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-22 13:35:11" itemprop="dateCreated datePublished" datetime="2021-06-22T13:35:11+08:00">2021-06-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 11:42:47" itemprop="dateModified" datetime="2023-10-25T11:42:47+08:00">2023-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="跳表-skiplist"><a href="#跳表-skiplist" class="headerlink" title="跳表 skiplist"></a>跳表 skiplist</h3><p>Binary trees can be used for representing abstract data<br>types such as dictionaries and ordered lists. They work<br>well when the elements are inserted in a random order.<br>二叉树可以使用来表达一个词典或者一个有序列表.当二叉树的元素插入是随机顺序的时候,他可以工作很好</p>
<p>Some sequences of operations, such as inserting the<br>elements in order, produce degenerate data structures<br>that perform very poo.rly.<br>但是一些特定的顺序,举个例子,如果插入的数据本身已经是有序的,那么效果则会很差<br> If it were possible to randomly permute the list of items to be inserted, trees<br>would work well with high probability for any input sequence.<br>如果可以产生随机的数据去插入,那么树会对输入的性能变得非常好<br> In most cases queries must be answered online, so randomly permuting the input is impractical.<br>Balanced tree algorithms rearrange the tree as operations are performed to maintain certain balance conditions and assure good performance.<br>在大部分的情况必须实时查询,所以随机交换输入是不可能的,平衡树需要重排来保证某些平衡的条件和确保比较好的性能<br>Skip lists are a probabilistic alternative to balanced trees.<br>跳表相对于平衡树来说是另外一个选择<br> Skip lists are balanced by consulting a random number generator.<br> 跳表的平衡是通过获取一个随机数<br>  Although skip lists have bad worstcase performance, no input sequence consistently produces the worst-case performance (much like quicksort when the pivot element is chosen randomly).<br>  虽然跳表也有bad case(举个例子每次随机的高度都一样) , 但是没有一个输入序列可以把这个bad case稳定的生成(因为是随机产生所以不会一直产生最坏情况)<br>   It is very unlikely a skip list data structure will be significantly unbalanced (e.g., for a dictionary of more than 250 elements, the chance that a search will take more than three-times the expeci.ed time is less than one in a million). Skip lists have balance properties similar to that of search trees built by random insertions, yet do not require insertions to be random.<br>   这不太可能跳表变得非常显著地不平衡,跳表的平衡性质和一个随机插入的搜索树相类似,但是不需要随机去插入<br>It is easier to balance a data structure probabilistitally than to explicitly maintain the balance.<br>通过概率去平衡一个暑假结构比显式保持它的平衡要简单<br>For many applications, skip lists are a more natural representation than trees, and they lead to simpler algorithms.<br>对于很多应用,相对于树来说跳表会更加自然.<br>The simplicity of skip list algorithms makes them easier to implement and provides significant constant factor speed improvements over balanced tree and self-adjusting tree algorithms.<br>跳表的简易型可以实现和提供一个显著的常量因子去比平衡树和自适应树更好<br>Skip lists are also very space efficient.<br>跳表的空间利用率很高<br> They can easily be configured to require an average of 1% pointers per element (or even less) and do not require balance or priority information to be stored with each node.<br> 他们可以需要平均百分之1的指针和不需要平衡或者权重信息取存储每个节点</p>
<p> SKIP LISTS<br> 跳表<br>We might need to examine every node of the list when searching a linked list (Figure la).<br>当我们使用链表这个结构来存储数据,如果我们要搜索某个节点,我们需要顺序遍历每个节点.<br>If the list is stored in sorted order and every other node of the list also has a pointer to the node two ahead of it in the list (Figure lb), we have to examine no more than [n&#x2F;21 +1 nodes (where n is the length of the list).<br>如果这个list是<br> Also giving<br>every fourth node a pointer four ahead (Figure lc) requires that no more than rn&#x2F;41 + 2 nodes be examined.<br>If every (27th node has a pointer 2’ nodes ahead (Figure Id), the number of nodes that must be examined<br>can be reduced to rlog,nl while only doubling the number of pointers. This data structure could be used for<br>fast searching, but insertion and deletion would be impractical.<br>A node that has k forward pointers is called a level k<br>node. If every (2’)th node has a pointer 2’ nodes ahead,<br>then levels of nodes are distributed in a simple pattern:<br>50 percent are level 1, 25 percent are level 2, 12.5<br>percent are level 3 and so on. What would happen if<br>the levels of nodes were chosen randomly, but in the<br>same proportions (e.g., as in Figure le)? A node’s ith<br>forward pointer, instead of pointing 2’-’ nodes ahead,<br>points to the next node of level i or higher. Insertions or<br>deletions would require only local modifications; the<br>level of a node, chosen randomly when the node is<br>inserted, need never change. Some arrangements of<br>levels would give poor execution times, but we will see<br>that such arrangements are rare. Because these data<br>structures are linked lists with extra pointers that s</p>
<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><ul>
<li><a target="_blank" rel="noopener" href="https://homepage.divms.uiowa.edu/~ghosh/skip.pdf">https://homepage.divms.uiowa.edu/~ghosh/skip.pdf</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shakudada.xyz/2021/06/04/mongoinsert/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dinosaur">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dinosaur">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/04/mongoinsert/" class="post-title-link" itemprop="url">mongoinsert</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-04 12:59:46" itemprop="dateCreated datePublished" datetime="2021-06-04T12:59:46+08:00">2021-06-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 11:42:47" itemprop="dateModified" datetime="2023-10-25T11:42:47+08:00">2023-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>mongo 的wiredtiger 是怎么组织kv结构的呢?<br>我现在还是没有弄懂</p>
<p>堆栈:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">Thread 41 &quot;conn1&quot; hit Breakpoint 5, __wt_btcur_insert (cbt=cbt@entry=0x555560bd2000) at src/third_party/wiredtiger/src/btree/bt_cursor.c:763</span><br><span class="line">763	&#123;</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  __wt_btcur_insert (cbt=cbt@entry=0x555560bd2000) at src/third_party/wiredtiger/src/btree/bt_cursor.c:763</span><br><span class="line">#1  0x0000555556d6149a in __curfile_insert (cursor=0x555560bd2000) at src/third_party/wiredtiger/src/cursor/cur_file.c:266</span><br><span class="line">#2  0x0000555556cd3ef4 in mongo::wiredTigerCursorInsert (opCtx=opCtx@entry=0x555560af8180, cursor=cursor@entry=0x555560bd2000)</span><br><span class="line">    at src/mongo/db/storage/wiredtiger/wiredtiger_cursor_helpers.cpp:39</span><br><span class="line">#3  0x0000555556d131bd in mongo::WiredTigerRecordStore::_insertRecords (this=0x55555bfddc00, opCtx=0x555560af8180, records=&lt;optimized out&gt;, timestamps=0x55555c01a478, nRecords=1)</span><br><span class="line">    at src/mongo/db/storage/wiredtiger/wiredtiger_record_store.cpp:1319</span><br><span class="line">#4  0x0000555556d13ae7 in mongo::WiredTigerRecordStore::insertRecords (this=&lt;optimized out&gt;, opCtx=&lt;optimized out&gt;, records=&lt;optimized out&gt;, timestamps=...)</span><br><span class="line">    at /usr/include/c++/9/bits/stl_vector.h:915</span><br><span class="line">#5  0x0000555557bf9972 in mongo::CollectionImpl::_insertDocuments (this=0x55555bfe1410, opCtx=0x555560af8180, begin=..., end=..., opDebug=0x555560b40a50, fromMigrate=false)</span><br><span class="line">    at /usr/include/c++/9/bits/unique_ptr.h:360</span><br><span class="line">#6  0x0000555557bfa333 in mongo::CollectionImpl::insertDocuments (this=this@entry=0x55555bfe1410, opCtx=opCtx@entry=0x555560af8180, begin=begin@entry=</span><br><span class="line">        &#123;stmtIds = std::vector of length 1, capacity 1 = &#123;-1&#125;, oplogSlot = &#123;static kTermFieldName = &#123;_data = 0x555559e64ab2 &quot;t&quot;, _size = 1&#125;, static kTimestampFieldName = &#123;_data = 0x555559e5c074 &quot;ts&quot;, _size = 2&#125;, static kUninitializedTerm = -1, static kInitialTerm = 0, _timestamp = &#123;static kAllowUnstableCheckpointsSentinel = &#123;static kAllowUnstableCheckpointsSentinel = &lt;same as static member of an already seen type&gt;, i = 1, secs = 0&#125;, i = 0, secs = 0&#125;, _term = -1&#125;, doc = &#123;static kMinBSONLength = 5 &#x27;\005&#x27;, static kEmptyObjectPrototype = &quot;\005\000\000\000&quot;, _objdata = 0x55556036f92b &quot;-&quot;, _ownedBuffer = &#123;_buffer = &#123;_holder = &#123;px = 0x55556036f900&#125;, static kHolderSize = 8&#125;&#125;&#125;&#125;, end=end@entry=</span><br><span class="line">    &#123;stmtIds = std::vector of length -28, capacity 23456275625363 = &#123;&lt;error reading variable&gt;, opDebug=0x555560b40a50, fromMigrate=false)</span><br><span class="line">    at src/mongo/db/catalog/collection_impl.cpp:663</span><br><span class="line">#7  0x0000555557a0a1ae in mongo::write_ops_exec::(anonymous namespace)::insertDocuments (opCtx=0x555560af8180, collection=..., begin=..., end=</span><br><span class="line">    &#123;stmtIds = std::vector of length -28, capacity 23456275625363 = &#123;&lt;error reading variable&gt;, fromMigrate=&lt;optimized out&gt;) at /usr/include/c++/9/bits/stl_iterator.h:871</span><br><span class="line">#8  0x0000555557a0a631 in mongo::write_ops_exec::(anonymous namespace)::&lt;lambda()&gt;::operator()(void) const (__closure=0x7fffe5962a30) at src/mongo/db/catalog_raii.h:151</span><br><span class="line">#9  0x0000555557a0ac1b in mongo::writeConflictRetry&lt;mongo::write_ops_exec::(anonymous namespace)::insertBatchAndHandleErrors(mongo::OperationContext*, const mongo::write_ops::InsertCommandRequest&amp;, std::vector&lt;mongo::InsertStatement&gt;&amp;, mongo::write_ops_exec::(anonymous namespace)::LastOpFixer*, mongo::write_ops_exec::WriteResult*, mongo::OperationSource)::&lt;lambda()&gt; &gt; (f=..., ns=..., opStr=..., opCtx=0x555560af8180) at /usr/include/c++/9/bits/stl_iterator.h:806</span><br><span class="line">#10 mongo::write_ops_exec::(anonymous namespace)::insertBatchAndHandleErrors (source=&lt;optimized out&gt;, out=&lt;optimized out&gt;, lastOpFixer=&lt;optimized out&gt;, </span><br><span class="line">    batch=std::vector of length 1, capacity 1 = &#123;...&#125;, wholeOp=..., opCtx=&lt;optimized out&gt;) at src/mongo/db/ops/write_ops_exec.cpp:502</span><br><span class="line">#11 mongo::write_ops_exec::performInserts (opCtx=&lt;optimized out&gt;, opCtx@entry=0x555560af8180, wholeOp=..., source=@0x7fffe5962e00: mongo::kStandard)</span><br><span class="line">    at src/mongo/db/ops/write_ops_exec.cpp:655</span><br><span class="line">#12 0x000055555791d28e in mongo::(anonymous namespace)::CmdInsert::Invocation::typedRun (this=0x555560ba0000, opCtx=0x555560af8180) at src/mongo/db/commands.h:1173</span><br><span class="line">#13 0x000055555791e8a0 in mongo::TypedCommand&lt;mongo::(anonymous namespace)::CmdInsert&gt;::InvocationBase::_callTypedRun (opCtx=&lt;optimized out&gt;, this=&lt;optimized out&gt;)</span><br><span class="line">    at src/mongo/db/commands.h:1255</span><br><span class="line">#14 mongo::TypedCommand&lt;mongo::(anonymous namespace)::CmdInsert&gt;::InvocationBase::_runImpl (reply=0x555561392000, opCtx=&lt;optimized out&gt;, this=&lt;optimized out&gt;)</span><br><span class="line">    at src/mongo/db/commands.h:1256</span><br><span class="line">#15 mongo::TypedCommand&lt;mongo::(anonymous namespace)::CmdInsert&gt;::InvocationBase::run (this=&lt;optimized out&gt;, opCtx=&lt;optimized out&gt;, reply=0x555561392000)</span><br><span class="line">    at src/mongo/db/commands.h:1261</span><br><span class="line">#16 0x0000555558791662 in mongo::CommandHelpers::runCommandInvocation (opCtx=0x555560af8180, request=..., invocation=0x555560ba0000, response=0x555561392000)</span><br><span class="line">    at src/mongo/db/commands.cpp:200</span><br><span class="line">#17 0x0000555558797d73 in mongo::CommandHelpers::&lt;lambda()&gt;::operator() (__closure=0x7fffe5963180) at src/mongo/db/commands.cpp:184</span><br><span class="line">#18 mongo::makeReadyFutureWith&lt;mongo::CommandHelpers::runCommandInvocation(std::shared_ptr&lt;mongo::RequestExecutionContext&gt;, std::shared_ptr&lt;mongo::CommandInvocation&gt;, mongo::transport::ServiceExecutor::ThreadingModel)::&lt;lambda()&gt; &gt; (func=...) at src/mongo/util/future.h:1208</span><br><span class="line">#19 mongo::CommandHelpers::runCommandInvocation (rec=std::shared_ptr&lt;class mongo::RequestExecutionContext&gt; (use count 11, weak count 0) = &#123;...&#125;, </span><br><span class="line">    invocation=std::shared_ptr&lt;class mongo::CommandInvocation&gt; (use count 3, weak count 0) = &#123;...&#125;, threadingModel=&lt;optimized out&gt;) at src/mongo/db/commands.cpp:185</span><br><span class="line">#20 0x0000555556c48367 in mongo::(anonymous namespace)::runCommandInvocation (rec=std::shared_ptr&lt;class mongo::RequestExecutionContext&gt; (empty) = &#123;...&#125;, </span><br><span class="line">    invocation=std::shared_ptr&lt;class mongo::CommandInvocation&gt; (empty) = &#123;...&#125;) at /usr/include/c++/9/bits/shared_ptr_base.h:756</span><br><span class="line">--Type &lt;RET&gt; for more, q to quit, c to continue without paging--</span><br><span class="line">#21 0x0000555556c5c389 in mongo::(anonymous namespace)::InvokeCommand::&lt;lambda()&gt;::operator() (__closure=&lt;optimized out&gt;) at /usr/include/c++/9/bits/shared_ptr_base.h:756</span><br><span class="line">#22 mongo::makeReadyFutureWith&lt;mongo::(anonymous namespace)::InvokeCommand::run()::&lt;lambda()&gt; &gt; (func=...) at src/mongo/util/future.h:1211</span><br><span class="line">#23 mongo::(anonymous namespace)::InvokeCommand::run (this=0x55555c01a4a0) at src/mongo/db/service_entry_point_common.cpp:842</span><br><span class="line">#24 mongo::(anonymous namespace)::RunCommandImpl::&lt;lambda(auto:78*)&gt;::operator()&lt;mongo::(anonymous namespace)::InvokeCommand&gt; (__closure=&lt;optimized out&gt;, path=0x55555c01a4a0)</span><br><span class="line">    at src/mongo/db/service_entry_point_common.cpp:1188</span><br><span class="line">#25 mongo::future_util::AsyncState&lt;mongo::(anonymous namespace)::InvokeCommand&gt;::&lt;lambda()&gt;::operator() (this=&lt;optimized out&gt;, this=&lt;optimized out&gt;)</span><br><span class="line">    at src/mongo/util/future_util.h:742</span><br><span class="line">#26 mongo::makeReadyFutureWith&lt;mongo::future_util::AsyncState&lt;State&gt;::thenWithState(Launcher&amp;&amp;) &amp;&amp; [with Launcher = mongo::(anonymous namespace)::RunCommandImpl::_runCommand()::&lt;lambda(auto:78*)&gt;; State = mongo::(anonymous namespace)::InvokeCommand]::&lt;lambda()&gt; &gt; (func=...) at src/mongo/util/future.h:1211</span><br><span class="line">#27 mongo::future_util::AsyncState&lt;mongo::(anonymous namespace)::InvokeCommand&gt;::thenWithState&lt;mongo::(anonymous namespace)::RunCommandImpl::_runCommand()::&lt;lambda(auto:78*)&gt; &gt; (</span><br><span class="line">    launcher=..., this=&lt;optimized out&gt;) at src/mongo/util/future_util.h:747</span><br><span class="line">#28 mongo::(anonymous namespace)::RunCommandImpl::_runCommand (this=&lt;optimized out&gt;) at src/mongo/db/service_entry_point_common.cpp:1188</span><br><span class="line">#29 0x0000555556c5cc32 in mongo::(anonymous namespace)::RunCommandAndWaitForWriteConcern::_runCommandWithFailPoint (this=0x555560ba00e0)</span><br><span class="line">    at src/mongo/db/service_entry_point_common.cpp:1299</span><br><span class="line">#30 0x0000555556c5d1c3 in mongo::(anonymous namespace)::RunCommandAndWaitForWriteConcern::_runImpl (this=0x555560ba00e0) at src/mongo/db/service_entry_point_common.cpp:1219</span><br><span class="line">#31 0x0000555556c4b9ad in mongo::(anonymous namespace)::RunCommandImpl::&lt;lambda()&gt;::operator() (__closure=&lt;optimized out&gt;) at src/mongo/db/service_entry_point_common.cpp:730</span><br><span class="line">#32 mongo::makeReadyFutureWith&lt;mongo::(anonymous namespace)::RunCommandImpl::run()::&lt;lambda()&gt; &gt; (func=...) at src/mongo/util/future.h:1211</span><br><span class="line">#33 mongo::(anonymous namespace)::RunCommandImpl::run (this=0x555560ba00e0) at src/mongo/db/service_entry_point_common.cpp:728</span><br><span class="line">#34 0x0000555556c4f5b2 in mongo::(anonymous namespace)::ExecCommandDatabase::&lt;lambda()&gt;::&lt;lambda(auto:79*)&gt;::operator()&lt;mongo::(anonymous namespace)::RunCommandAndWaitForWriteConcern&gt; (__closure=&lt;optimized out&gt;, runner=0x555560ba00e0) at src/mongo/db/service_entry_point_common.cpp:1651</span><br><span class="line">#35 mongo::future_util::AsyncState&lt;mongo::(anonymous namespace)::RunCommandAndWaitForWriteConcern&gt;::&lt;lambda()&gt;::operator() (this=&lt;optimized out&gt;, this=&lt;optimized out&gt;)</span><br><span class="line">    at src/mongo/util/future_util.h:742</span><br><span class="line">#36 mongo::makeReadyFutureWith&lt;mongo::future_util::AsyncState&lt;State&gt;::thenWithState(Launcher&amp;&amp;) &amp;&amp; [with Launcher = mongo::(anonymous namespace)::ExecCommandDatabase::_commandExec()::&lt;lambda()&gt;::&lt;lambda(auto:79*)&gt;; State = mongo::(anonymous namespace)::RunCommandAndWaitForWriteConcern]::&lt;lambda()&gt; &gt; (func=...) at src/mongo/util/future.h:1211</span><br><span class="line">#37 mongo::future_util::AsyncState&lt;mongo::(anonymous namespace)::RunCommandAndWaitForWriteConcern&gt;::thenWithState&lt;mongo::(anonymous namespace)::ExecCommandDatabase::_commandExec()::&lt;lambda()&gt;::&lt;lambda(auto:79*)&gt; &gt; (launcher=..., this=&lt;optimized out&gt;) at src/mongo/util/future_util.h:747</span><br><span class="line">#38 mongo::(anonymous namespace)::ExecCommandDatabase::&lt;lambda()&gt;::operator() (__closure=&lt;synthetic pointer&gt;) at src/mongo/db/service_entry_point_common.cpp:1651</span><br><span class="line">#39 mongo::(anonymous namespace)::ExecCommandDatabase::_commandExec (this=0x555560b57800) at src/mongo/db/service_entry_point_common.cpp:1658</span><br><span class="line">#40 0x0000555556c58516 in mongo::(anonymous namespace)::ExecCommandDatabase::&lt;lambda()&gt;::operator() (__closure=&lt;optimized out&gt;) at src/mongo/db/service_entry_point_common.cpp:625</span><br><span class="line">#41 mongo::makeReadyFutureWith&lt;mongo::(anonymous namespace)::ExecCommandDatabase::run()::&lt;lambda()&gt; &gt; (func=...) at src/mongo/util/future.h:1211</span><br><span class="line">#42 mongo::(anonymous namespace)::ExecCommandDatabase::run (this=0x555560b57800) at src/mongo/db/service_entry_point_common.cpp:623</span><br><span class="line">#43 mongo::(anonymous namespace)::&lt;lambda()&gt;::&lt;lambda(auto:81*)&gt;::operator()&lt;mongo::(anonymous namespace)::ExecCommandDatabase&gt; (__closure=&lt;optimized out&gt;, runner=0x555560b57800)</span><br><span class="line">    at src/mongo/db/service_entry_point_common.cpp:1880</span><br><span class="line">#44 mongo::future_util::AsyncState&lt;mongo::(anonymous namespace)::ExecCommandDatabase&gt;::&lt;lambda()&gt;::operator()(void) const (this=&lt;optimized out&gt;, this=&lt;optimized out&gt;)</span><br><span class="line">    at src/mongo/util/future_util.h:742</span><br><span class="line">#45 0x0000555556c58be2 in mongo::makeReadyFutureWith&lt;mongo::future_util::AsyncState&lt;State&gt;::thenWithState(Launcher&amp;&amp;) &amp;&amp; [with Launcher = mongo::(anonymous namespace)::executeCommand(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt; mutable::&lt;lambda(auto:81*)&gt;; State = mongo::(anonymous namespace)::ExecCommandDatabase]::&lt;lambda()&gt; &gt; (func=...) at src/mongo/util/future.h:1206</span><br><span class="line">#46 mongo::future_util::AsyncState&lt;mongo::(anonymous namespace)::ExecCommandDatabase&gt;::thenWithState&lt;mongo::(anonymous namespace)::executeCommand(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt; mutable::&lt;lambda(auto:81*)&gt; &gt; (launcher=..., this=0x7fffe59639c0) at src/mongo/util/future_util.h:747</span><br><span class="line">#47 mongo::(anonymous namespace)::&lt;lambda()&gt;::operator() (__closure=&lt;optimized out&gt;) at src/mongo/db/service_entry_point_common.cpp:1880</span><br><span class="line">#48 mongo::future_details::call&lt;mongo::(anonymous namespace)::executeCommand(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt;&amp;&gt; (func=...)</span><br><span class="line">    at src/mongo/util/future_impl.h:255</span><br><span class="line">--Type &lt;RET&gt; for more, q to quit, c to continue without paging--</span><br><span class="line">#49 mongo::future_details::throwingCall&lt;mongo::(anonymous namespace)::executeCommand(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt;&amp;, mongo::future_details::FakeVoid&gt; (func=...) at src/mongo/util/future_impl.h:308</span><br><span class="line">#50 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::&lt;lambda()&gt;::&lt;lambda(mongo::future_details::SharedState&lt;mongo::future_details::FakeVoid&gt;*, mongo::future_details::SharedState&lt;void&gt;*)&gt;::operator() (output=0x555560b43200, input=&lt;optimized out&gt;, this=&lt;optimized out&gt;) at src/mongo/util/future_impl.h:935</span><br><span class="line">#51 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::&lt;lambda(mongo::future_details::SharedStateBase*)&gt;::operator() (ssb=&lt;optimized out&gt;, this=&lt;optimized out&gt;)</span><br><span class="line">    at src/mongo/util/future_impl.h:1257</span><br><span class="line">#52 mongo::unique_function&lt;void(mongo::future_details::SharedStateBase*)&gt;::callRegularVoid&lt;mongo::future_details::FutureImpl&lt;T&gt;::makeContinuation(OnReady&amp;&amp;) [with Result = void; OnReady = mongo::future_details::FutureImpl&lt;T&gt;::then(Func&amp;&amp;) &amp;&amp; [with Func = mongo::(anonymous namespace)::executeCommand(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt;; T = mongo::future_details::FakeVoid]::&lt;lambda()&gt;::&lt;lambda(mongo::future_details::SharedState&lt;mongo::future_details::FakeVoid&gt;*, mongo::future_details::SharedState&lt;void&gt;*)&gt;; T = mongo::future_details::FakeVoid]::&lt;lambda(mongo::future_details::SharedStateBase*)&gt; &gt; (args#0=&lt;optimized out&gt;, f=..., isVoid=...)</span><br><span class="line">    at src/mongo/util/functional.h:145</span><br><span class="line">#53 mongo::unique_function&lt;void(mongo::future_details::SharedStateBase*)&gt;::SpecificImpl::call(mongo::future_details::SharedStateBase *&amp;&amp;) (this=&lt;optimized out&gt;, </span><br><span class="line">    args#0=&lt;optimized out&gt;) at src/mongo/util/functional.h:159</span><br><span class="line">#54 0x0000555556c14b27 in mongo::unique_function&lt;void (mongo::future_details::SharedStateBase*)&gt;::operator()(mongo::future_details::SharedStateBase*) const (args#0=&lt;optimized out&gt;, </span><br><span class="line">    this=0x555560b43818) at src/mongo/util/invariant.h:66</span><br><span class="line">#55 mongo::future_details::SharedStateBase::transitionToFinished (this=0x555560b43800) at src/mongo/util/future_impl.h:441</span><br><span class="line">#56 0x0000555556c5fcd2 in mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;::emplaceValue&lt;mongo::future_details::FakeVoid&gt; (this=&lt;optimized out&gt;)</span><br><span class="line">    at /usr/include/c++/9/new:174</span><br><span class="line">#57 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda(mongo::future_details::FakeVoid&amp;&amp;)#1&#125;::operator()(mongo::future_details::FakeVoid&amp;&amp;) const (this=&lt;optimized out&gt;, val=...) at src/mongo/util/future_impl.h:1146</span><br><span class="line">#58 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::generalImpl&lt;mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda(mongo::future_details::FakeVoid&amp;&amp;)#1&#125;, mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda(mongo::Status&amp;&amp;)#2&#125;, mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda()#3&#125;&gt;(mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda(mongo::future_details::FakeVoid&amp;&amp;)#1&#125;&amp;&amp;, mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda(mongo::Status&amp;&amp;)#2&#125;&amp;&amp;, mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda()#3&#125;&amp;&amp;) (notReady=..., </span><br><span class="line">    fail=..., success=..., this=&lt;optimized out&gt;) at src/mongo/util/future_impl.h:1191</span><br><span class="line">#59 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::generalImpl&lt;mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda(mongo::future_details::FakeVoid&amp;&amp;)#1&#125;, mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda(mongo::Status&amp;&amp;)#2&#125;, mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda()#3&#125;&gt;(mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda(mongo::future_details::FakeVoid&amp;&amp;)#1&#125;&amp;&amp;, mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda(mongo::Status&amp;&amp;)#2&#125;&amp;&amp;, mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp;::&#123;lambda()#3&#125;&amp;&amp;) (</span><br><span class="line">    this=&lt;optimized out&gt;, success=..., fail=..., notReady=...) at src/mongo/util/future_impl.h:1182</span><br><span class="line">#60 0x0000555556c520ac in mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::propagateResultTo(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*) &amp;&amp; (output=&lt;optimized out&gt;, this=0x7fffe5963b40) at src/mongo/util/future_impl.h:1143</span><br><span class="line">#61 mongo::SemiFuture&lt;void&gt;::propagateResultTo&lt;mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*&amp;&gt;(mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;*&amp;) &amp;&amp; (arg=&lt;synthetic pointer&gt;: &lt;optimized out&gt;, this=0x7fffe5963b40) at src/mongo/util/future.h:285</span><br><span class="line">#62 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::&lt;lambda()&gt;::&lt;lambda(mongo::future_details::SharedState&lt;mongo::future_details::FakeVoid&gt;*, mongo::future_details::SharedState&lt;void&gt;*)&gt;::operator() (output=0x555560b43800, input=&lt;optimized out&gt;, this=&lt;optimized out&gt;) at src/mongo/util/future_impl.h:935</span><br><span class="line">#63 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::&lt;lambda(mongo::future_details::SharedStateBase*)&gt;::operator() (ssb=&lt;optimized out&gt;, this=&lt;optimized out&gt;)</span><br><span class="line">--Type &lt;RET&gt; for more, q to quit, c to continue without paging--</span><br><span class="line">    at src/mongo/util/future_impl.h:1257</span><br><span class="line">#64 mongo::unique_function&lt;void(mongo::future_details::SharedStateBase*)&gt;::callRegularVoid&lt;mongo::future_details::FutureImpl&lt;T&gt;::makeContinuation(OnReady&amp;&amp;) [with Result = void; OnReady = mongo::future_details::FutureImpl&lt;T&gt;::then(Func&amp;&amp;) &amp;&amp; [with Func = mongo::(anonymous namespace)::executeCommand(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt;; T = mongo::future_details::FakeVoid]::&lt;lambda()&gt;::&lt;lambda(mongo::future_details::SharedState&lt;mongo::future_details::FakeVoid&gt;*, mongo::future_details::SharedState&lt;void&gt;*)&gt;; T = mongo::future_details::FakeVoid]::&lt;lambda(mongo::future_details::SharedStateBase*)&gt; &gt; (args#0=&lt;optimized out&gt;, f=..., isVoid=...)</span><br><span class="line">    at src/mongo/util/functional.h:145</span><br><span class="line">#65 mongo::unique_function&lt;void(mongo::future_details::SharedStateBase*)&gt;::SpecificImpl::call(mongo::future_details::SharedStateBase *&amp;&amp;) (this=&lt;optimized out&gt;, </span><br><span class="line">    args#0=&lt;optimized out&gt;) at src/mongo/util/functional.h:159</span><br><span class="line">#66 0x0000555556c14b27 in mongo::unique_function&lt;void (mongo::future_details::SharedStateBase*)&gt;::operator()(mongo::future_details::SharedStateBase*) const (args#0=&lt;optimized out&gt;, </span><br><span class="line">    this=0x555560b42d18) at src/mongo/util/invariant.h:66</span><br><span class="line">#67 mongo::future_details::SharedStateBase::transitionToFinished (this=0x555560b42d00) at src/mongo/util/future_impl.h:441</span><br><span class="line">#68 0x0000555556c59141 in mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt;::emplaceValue&lt;&gt;() (this=0x555560b42d00) at /usr/include/c++/9/new:174</span><br><span class="line">#69 mongo::Promise&lt;void&gt;::emplaceValue&lt;, 0&gt;()::&#123;lambda(boost::intrusive_ptr&lt;mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt; &gt;&amp;&amp;)#1&#125;::operator()(boost::intrusive_ptr&lt;mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt; &gt;&amp;&amp;) const (this=&lt;optimized out&gt;, sharedState=&lt;synthetic pointer&gt;) at src/mongo/util/future.h:854</span><br><span class="line">#70 mongo::Promise&lt;void&gt;::setImpl&lt;mongo::Promise&lt;void&gt;::emplaceValue&lt;, 0&gt;()::&#123;lambda(boost::intrusive_ptr&lt;mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt; &gt;&amp;&amp;)#1&#125;&gt;(mongo::Promise&lt;void&gt;::emplaceValue&lt;, 0&gt;()::&#123;lambda(boost::intrusive_ptr&lt;mongo::future_details::SharedStateImpl&lt;mongo::future_details::FakeVoid&gt; &gt;&amp;&amp;)#1&#125;&amp;&amp;) (doSet=..., </span><br><span class="line">    this=0x7fffe5963ce0) at src/mongo/util/future.h:895</span><br><span class="line">#71 mongo::Promise&lt;void&gt;::emplaceValue&lt;, 0&gt;() (this=0x7fffe5963ce0) at src/mongo/util/future.h:853</span><br><span class="line">#72 mongo::(anonymous namespace)::executeCommand (execContext=...) at src/mongo/db/service_entry_point_common.cpp:1892</span><br><span class="line">#73 0x0000555556c59cbf in mongo::(anonymous namespace)::&lt;lambda()&gt;::operator() (__closure=&lt;optimized out&gt;) at /usr/include/c++/9/bits/shared_ptr_base.h:756</span><br><span class="line">#74 mongo::future_details::call&lt;mongo::(anonymous namespace)::receivedCommands(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt;&amp;&gt; (</span><br><span class="line">    func=...) at src/mongo/util/future_impl.h:255</span><br><span class="line">#75 mongo::future_details::throwingCall&lt;mongo::(anonymous namespace)::receivedCommands(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt;&amp;, mongo::future_details::FakeVoid&gt; (func=...) at src/mongo/util/future_impl.h:308</span><br><span class="line">#76 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::&lt;lambda(mongo::future_details::FakeVoid&amp;&amp;)&gt;::operator()(mongo::future_details::FakeVoid &amp;&amp;) (val=..., </span><br><span class="line">    this=&lt;optimized out&gt;) at src/mongo/util/future_impl.h:917</span><br><span class="line">#77 0x0000555556c59e8a in mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::generalImpl&lt;mongo::future_details::FutureImpl&lt;T&gt;::then(Func&amp;&amp;) &amp;&amp; [with Func = mongo::(anonymous namespace)::receivedCommands(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt;; T = mongo::future_details::FakeVoid]::&lt;lambda(mongo::future_details::FakeVoid&amp;&amp;)&gt;, mongo::future_details::FutureImpl&lt;T&gt;::then(Func&amp;&amp;) &amp;&amp; [with Func = mongo::(anonymous namespace)::receivedCommands(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt;; T = mongo::future_details::FakeVoid]::&lt;lambda(mongo::Status&amp;&amp;)&gt;, mongo::future_details::FutureImpl&lt;T&gt;::then(Func&amp;&amp;) &amp;&amp; [with Func = mongo::(anonymous namespace)::receivedCommands(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt;; T = mongo::future_details::FakeVoid]::&lt;lambda()&gt; &gt; (fail=..., notReady=..., success=..., this=0x7fffe5964110) at src/third_party/boost/boost/optional/detail/optional_aligned_storage.hpp:64</span><br><span class="line">#78 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::then&lt;mongo::(anonymous namespace)::receivedCommands(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt; &gt; (func=..., this=0x7fffe5964110) at src/mongo/util/future_impl.h:940</span><br><span class="line">#79 mongo::Future&lt;void&gt;::then&lt;mongo::(anonymous namespace)::receivedCommands(std::shared_ptr&lt;mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt;)::&lt;lambda()&gt; &gt; (</span><br><span class="line">    func=..., this=0x7fffe5964110) at src/mongo/util/future.h:405</span><br><span class="line">#80 mongo::(anonymous namespace)::receivedCommands (</span><br><span class="line">    execContext=std::shared_ptr&lt;class mongo::(anonymous namespace)::HandleRequest::ExecutionContext&gt; (use count 11, weak count 0) = &#123;...&#125;)</span><br><span class="line">    at src/mongo/db/service_entry_point_common.cpp:1939</span><br><span class="line">#81 0x0000555556c5b130 in mongo::(anonymous namespace)::CommandOpRunner::run (this=&lt;optimized out&gt;) at /usr/include/c++/9/ext/atomicity.h:96</span><br><span class="line">#82 0x0000555556c54f9f in mongo::ServiceEntryPointCommon::handleRequest (opCtx=opCtx@entry=0x555560af8180, m=..., </span><br><span class="line">    behaviors=std::unique_ptr&lt;const class mongo::ServiceEntryPointCommon::Hooks&gt; = &#123;...&#125;) at src/mongo/db/service_entry_point_common.cpp:2441</span><br><span class="line">#83 0x0000555556c41514 in mongo::ServiceEntryPointMongod::handleRequest (this=&lt;optimized out&gt;, opCtx=0x555560af8180, m=...) at /usr/include/c++/9/bits/move.h:74</span><br><span class="line">--Type &lt;RET&gt; for more, q to quit, c to continue without paging--</span><br><span class="line">#84 0x0000555556cabe0a in mongo::transport::ServiceStateMachine::Impl::processMessage (this=0x555560b81090) at src/mongo/transport/service_state_machine.cpp:466</span><br><span class="line">#85 0x0000555556caf176 in mongo::transport::ServiceStateMachine::Impl::&lt;lambda()&gt;::operator() (__closure=&lt;optimized out&gt;) at src/mongo/transport/service_state_machine.cpp:559</span><br><span class="line">#86 mongo::future_details::call&lt;mongo::transport::ServiceStateMachine::Impl::startNewLoop(const mongo::Status&amp;)::&lt;lambda()&gt;&amp;&gt; (func=...) at src/mongo/util/future_impl.h:255</span><br><span class="line">#87 mongo::future_details::throwingCall&lt;mongo::transport::ServiceStateMachine::Impl::startNewLoop(const mongo::Status&amp;)::&lt;lambda()&gt;&amp;, mongo::future_details::FakeVoid&gt; (func=...)</span><br><span class="line">    at src/mongo/util/future_impl.h:308</span><br><span class="line">#88 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::&lt;lambda(mongo::future_details::FakeVoid&amp;&amp;)&gt;::operator() (this=&lt;optimized out&gt;, val=...)</span><br><span class="line">    at src/mongo/util/future_impl.h:917</span><br><span class="line">#89 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::generalImpl&lt;mongo::future_details::FutureImpl&lt;T&gt;::then(Func&amp;&amp;) &amp;&amp; [with Func = mongo::transport::ServiceStateMachine::Impl::startNewLoop(const mongo::Status&amp;)::&lt;lambda()&gt;; T = mongo::future_details::FakeVoid]::&lt;lambda(mongo::future_details::FakeVoid&amp;&amp;)&gt;, mongo::future_details::FutureImpl&lt;T&gt;::then(Func&amp;&amp;) &amp;&amp; [with Func = mongo::transport::ServiceStateMachine::Impl::startNewLoop(const mongo::Status&amp;)::&lt;lambda()&gt;; T = mongo::future_details::FakeVoid]::&lt;lambda(mongo::Status&amp;&amp;)&gt;, mongo::future_details::FutureImpl&lt;T&gt;::then(Func&amp;&amp;) &amp;&amp; [with Func = mongo::transport::ServiceStateMachine::Impl::startNewLoop(const mongo::Status&amp;)::&lt;lambda()&gt;; T = mongo::future_details::FakeVoid]::&lt;lambda()&gt; &gt; (fail=..., notReady=..., success=..., this=0x7fffe5964780) at src/mongo/util/future_impl.h:1184</span><br><span class="line">#90 mongo::future_details::FutureImpl&lt;mongo::future_details::FakeVoid&gt;::then&lt;mongo::transport::ServiceStateMachine::Impl::startNewLoop(const mongo::Status&amp;)::&lt;lambda()&gt; &gt; (</span><br><span class="line">    func=..., this=0x7fffe5964780) at src/mongo/util/future_impl.h:940</span><br><span class="line">#91 mongo::Future&lt;void&gt;::then&lt;mongo::transport::ServiceStateMachine::Impl::startNewLoop(const mongo::Status&amp;)::&lt;lambda()&gt; &gt; (func=..., this=0x7fffe5964780)</span><br><span class="line">    at src/mongo/util/future.h:405</span><br><span class="line">#92 mongo::transport::ServiceStateMachine::Impl::startNewLoop (execStatus=..., this=0x555560b81090) at src/mongo/transport/service_state_machine.cpp:559</span><br><span class="line">#93 mongo::transport::ServiceStateMachine::Impl::startNewLoop (this=0x555560b81090, execStatus=...) at src/mongo/transport/service_state_machine.cpp:546</span><br><span class="line">#94 0x0000555556caf8e4 in mongo::transport::ServiceStateMachine::Impl::&lt;lambda(mongo::Status)&gt;::&lt;lambda(mongo::Status)&gt;::&lt;lambda()&gt;::operator() (__closure=&lt;synthetic pointer&gt;, </span><br><span class="line">    __closure=&lt;synthetic pointer&gt;) at src/mongo/transport/service_state_machine.cpp:588</span><br><span class="line">#95 mongo::ClientStrand::run&lt;mongo::transport::ServiceStateMachine::Impl::startNewLoop(const mongo::Status&amp;)::&lt;lambda(mongo::Status)&gt;::&lt;lambda(mongo::Status)&gt;::&lt;lambda()&gt; &gt; (</span><br><span class="line">    task=..., this=&lt;optimized out&gt;) at src/mongo/db/client_strand.h:165</span><br><span class="line">#96 mongo::transport::ServiceStateMachine::Impl::&lt;lambda(mongo::Status)&gt;::&lt;lambda(mongo::Status)&gt;::operator() (__closure=&lt;optimized out&gt;, execStatus=...)</span><br><span class="line">    at src/mongo/transport/service_state_machine.cpp:588</span><br><span class="line">#97 mongo::unique_function&lt;void(mongo::Status)&gt;::callRegularVoid&lt;mongo::transport::ServiceStateMachine::Impl::startNewLoop(const mongo::Status&amp;)::&lt;lambda(mongo::Status)&gt;::&lt;lambda(mongo::Status)&gt; &gt; (args#0=..., f=..., isVoid=...) at src/mongo/util/functional.h:145</span><br><span class="line">#98 mongo::unique_function&lt;void(mongo::Status)&gt;::SpecificImpl::call(mongo::Status &amp;&amp;) (this=&lt;optimized out&gt;, args#0=...) at src/mongo/util/functional.h:159</span><br><span class="line">#99 0x00005555592c9065 in mongo::unique_function&lt;void (mongo::Status)&gt;::operator()(mongo::Status) const (args#0=..., this=&lt;optimized out&gt;) at src/mongo/util/invariant.h:66</span><br><span class="line">#100 mongo::transport::ServiceExecutorSynchronous::&lt;lambda(mongo::Status)&gt;::operator() (status=..., __closure=&lt;optimized out&gt;)</span><br><span class="line">    at src/mongo/transport/service_executor_synchronous.cpp:163</span><br><span class="line">#101 mongo::unique_function&lt;void(mongo::Status)&gt;::callRegularVoid&lt;mongo::transport::ServiceExecutorSynchronous::runOnDataAvailable(const SessionHandle&amp;, mongo::OutOfLineExecutor::Task)::&lt;lambda(mongo::Status)&gt; &gt; (args#0=..., f=..., isVoid=...) at src/mongo/util/functional.h:145</span><br><span class="line">#102 mongo::unique_function&lt;void(mongo::Status)&gt;::SpecificImpl::call(mongo::Status &amp;&amp;) (this=&lt;optimized out&gt;, args#0=...) at src/mongo/util/functional.h:159</span><br><span class="line">#103 0x000055555741b9d8 in mongo::unique_function&lt;void (mongo::Status)&gt;::operator()(mongo::Status) const (args#0=..., this=&lt;optimized out&gt;) at src/mongo/util/invariant.h:66</span><br><span class="line">#104 mongo::transport::ServiceExecutor::schedule(mongo::unique_function&lt;void (mongo::Status)&gt;)::&#123;lambda()#1&#125;::operator()() (__closure=&lt;optimized out&gt;)</span><br><span class="line">    at src/mongo/transport/service_executor.h:111</span><br><span class="line">#105 mongo::unique_function&lt;void ()&gt;::callRegularVoid&lt;mongo::transport::ServiceExecutor::schedule(mongo::unique_function&lt;void (mongo::Status)&gt;)::&#123;lambda()#1&#125;&gt;(std::integral_constant&lt;bool, true&gt;, mongo::transport::ServiceExecutor::schedule(mongo::unique_function&lt;void (mongo::Status)&gt;)::&#123;lambda()#1&#125;&amp;) (f=..., isVoid=...) at src/mongo/util/functional.h:145</span><br><span class="line">#106 mongo::unique_function&lt;void ()&gt;::makeImpl&lt;mongo::transport::ServiceExecutor::schedule(mongo::unique_function&lt;void (mongo::Status)&gt;)::&#123;lambda()#1&#125;&gt;(mongo::transport::ServiceExecutor::schedule(mongo::unique_function&lt;void (mongo::Status)&gt;)::&#123;lambda()#1&#125;&amp;&amp;)::SpecificImpl::call() (this=&lt;optimized out&gt;) at src/mongo/util/functional.h:159</span><br><span class="line">#107 0x00005555592c923f in mongo::unique_function&lt;void ()&gt;::operator()() const (this=&lt;optimized out&gt;) at src/mongo/util/invariant.h:66</span><br><span class="line">#108 mongo::transport::ServiceExecutorSynchronous::&lt;lambda()&gt;::operator() (__closure=0x55556037a1a8) at src/mongo/transport/service_executor_synchronous.cpp:131</span><br><span class="line">#109 mongo::unique_function&lt;void()&gt;::callRegularVoid&lt;mongo::transport::ServiceExecutorSynchronous::scheduleTask(mongo::transport::ServiceExecutor::Task, mongo::transport::ServiceExec--Type &lt;RET&gt; for more, q to quit, c to continue without paging--</span><br><span class="line">utor::ScheduleFlags)::&lt;lambda()&gt; &gt; (f=..., isVoid=...) at src/mongo/util/functional.h:145</span><br><span class="line">#110 mongo::unique_function&lt;void()&gt;::SpecificImpl::call(void) (this=0x55556037a1a0) at src/mongo/util/functional.h:159</span><br><span class="line">#111 0x00005555592cdc28 in mongo::unique_function&lt;void ()&gt;::operator()() const (this=0x555560b58f58) at src/mongo/util/invariant.h:66</span><br><span class="line">#112 mongo::&lt;lambda()&gt;::operator() (__closure=0x555560b58f48) at src/mongo/transport/service_executor_utils.cpp:111</span><br><span class="line">#113 mongo::unique_function&lt;void()&gt;::callRegularVoid&lt;mongo::launchServiceWorkerThread(mongo::unique_function&lt;void()&gt;)::&lt;lambda()&gt; &gt; (f=..., isVoid=...)</span><br><span class="line">    at src/mongo/util/functional.h:145</span><br><span class="line">#114 mongo::unique_function&lt;void()&gt;::SpecificImpl::call(void) (this=0x555560b58f40) at src/mongo/util/functional.h:159</span><br><span class="line">#115 0x00005555592cdca1 in mongo::unique_function&lt;void ()&gt;::operator()() const (this=0x55555c01a4b8) at src/mongo/util/invariant.h:66</span><br><span class="line">#116 mongo::(anonymous namespace)::runFunc (ctx=0x55555c01a4b8) at src/mongo/transport/service_executor_utils.cpp:64</span><br><span class="line">#117 0x00007ffff7b8a609 in start_thread (arg=&lt;optimized out&gt;) at pthread_create.c:477</span><br><span class="line">#118 0x00007ffff777f293 in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><ul>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1627006">https://cloud.tencent.com/developer/article/1627006</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35192280/article/details/112971258">https://blog.csdn.net/qq_35192280/article/details/112971258</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shakudada.xyz/2021/05/24/%E9%9C%8D%E5%B0%94%E9%80%BB%E8%BE%91-%E4%BB%8E%E5%BF%AB%E6%8E%92%E5%BC%80%E5%A7%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dinosaur">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dinosaur">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/24/%E9%9C%8D%E5%B0%94%E9%80%BB%E8%BE%91-%E4%BB%8E%E5%BF%AB%E6%8E%92%E5%BC%80%E5%A7%8B/" class="post-title-link" itemprop="url">霍尔逻辑_从快排开始</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-24 13:38:41" itemprop="dateCreated datePublished" datetime="2021-05-24T13:38:41+08:00">2021-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 11:42:47" itemprop="dateModified" datetime="2023-10-25T11:42:47+08:00">2023-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Campsisgrandiflora/article/details/111410348">什么是霍尔逻辑</a>:<br>霍尔逻辑由三个部分组成:   </li>
<li>ϕ被称为前置条件，</li>
<li>P是程序片段，</li>
<li>ψ称为后置条件</li>
</ul>
<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><ul>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1211.4470.pdf">https://arxiv.org/pdf/1211.4470.pdf</a></li>
<li>C. A. R. Hoare. Proof of correctness of data representations. Acta Inf.,<br>1:271–281, 1972</li>
<li>Bertrand Meyer. Object-oriented software construction. Prentice Hall, 2nd<br>edition, 1997. First Ed.: 1988.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shakudada.xyz/2021/05/24/%E5%A0%86%E6%A0%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dinosaur">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dinosaur">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/24/%E5%A0%86%E6%A0%88/" class="post-title-link" itemprop="url">堆栈</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-24 12:20:07" itemprop="dateCreated datePublished" datetime="2021-05-24T12:20:07+08:00">2021-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 11:42:47" itemprop="dateModified" datetime="2023-10-25T11:42:47+08:00">2023-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在x86_64中,调用栈是从高地址到低地址增长的, <code>%rbp</code>寄存器有两个核心的内容: </p>
<ul>
<li><code>0(%rbp)</code>也就是<code>%rbp</code>寄存器指向的寄存器内容,这个指针指向的地址也存着上一个堆栈的<code>%rbp</code>堆栈的地址 </li>
<li><code>8(%rbp)</code>也就是<code>%rbp</code>寄存器存着另外一个存的是返回地址,什么是返回地址?就是指令段的地址</li>
</ul>
<p>也就是rbp通过寄存器我们可以得到</p>
<ul>
<li><code>8(%rbp)</code>:上一个堆栈的<code>代码段</code>开始</li>
<li><code>(%rbp)</code>: 上一个堆栈的开始</li>
</ul>
<h4 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h4><ul>
<li>3.2.2节 <a target="_blank" rel="noopener" href="https://uclibc.org/docs/psABI-x86_64.pdf">https://uclibc.org/docs/psABI-x86_64.pdf</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shakudada.xyz/2021/05/21/vxlan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dinosaur">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dinosaur">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/21/vxlan/" class="post-title-link" itemprop="url">vxlan</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-21 08:48:26" itemprop="dateCreated datePublished" datetime="2021-05-21T08:48:26+08:00">2021-05-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 11:42:47" itemprop="dateModified" datetime="2023-10-25T11:42:47+08:00">2023-10-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>vxlan 是一个3层协议上加上2层协议的协议<br>由vetp解析出上面2层协议的报文</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/pdfrfc/rfc7348.txt.pdf">https://www.rfc-editor.org/rfc/pdfrfc/rfc7348.txt.pdf</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/16/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">dinosaur</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">256</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/769344359" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;769344359" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/thedinosaurmail@gmail.com" title="E-Mail → thedinosaurmail@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dinosaur</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>














  

  

</body>
</html>
